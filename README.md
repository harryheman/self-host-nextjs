# –ü—Ä–∏–º–µ—Ä —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Next.js

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Next.js –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Ubuntu Linux —Å –ø–æ–º–æ—â—å—é Docker –∏ Nginx. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Next.js, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, ISR, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –¥—Ä.

[**üìπ –°–º–æ—Ç—Ä–∏—Ç–µ —Ç—É—Ç–æ—Ä–∏–∞–ª (45 –º–∏–Ω)**](https://www.youtube.com/watch?v=sIVL4JMqRfc)

[![Self Hosting Video Thumbnail](https://img.youtube.com/vi/sIVL4JMqRfc/0.jpg)](https://www.youtube.com/watch?v=sIVL4JMqRfc)

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –ö—É–ø–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞.
2. –ö—É–ø–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä Linux Ubuntu.
3. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å DNS `A`, —É–∫–∞–∑—ã–≤–∞—é—â—É—é –Ω–∞ –∞–¥—Ä–µ—Å IPv4 –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

1. **–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH**:

```bash
ssh root@your_server_ip
```

2. **–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è**:

```bash
curl -o ~/deploy.sh https://raw.githubusercontent.com/leerob/next-self-host/main/deploy.sh
```

–£–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `DOMAIN_NAME` –∏ `EMAIL` –≤ —Ñ–∞–π–ª–µ `deploy.sh`.

3. **–ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è**:

```bash
chmod +x ~/deploy.sh
./deploy.sh
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–í —ç—Ç–æ–º –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Next.js:

- –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö
- –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î Postgres
- –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–∞
- –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –∑–∞–¥–∞—á–∞ cron, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∞—è —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —Ä–æ—É—Ç–∞

–°–º–æ—Ç—Ä–∏—Ç–µ [–¥–µ–º–æ](https://nextselfhost.ru) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–ª–µ–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç Bash, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ—Ä–≤–µ—Ä—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker, Docker Compose –∏ Nginx.
3. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ SSL.
5. –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Next.js —Å –ø–æ–º–æ—â—å—é Dockerfile.
6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx —Å HTTPS –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.
7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron, –æ—á–∏—â–∞—é—â–µ–≥–æ –ë–î –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω.
8. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `.env` —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Postgres.

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://your-provided-domain.com
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Next.js –∏ –ë–î PostgreSQL –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö. –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `psql`:

```bash
docker exec -it myapp-db-1 sh
apk add --no-cache postgresql-client
psql -U myuser -d mydatabase -c '
CREATE TABLE IF NOT EXISTS "todos" (
  "id" serial PRIMARY KEY NOT NULL,
  "content" varchar(255) NOT NULL,
  "completed" boolean DEFAULT false,
  "created_at" timestamp DEFAULT now()
);'
```

–î–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Å–∫—Ä–∏–ø—Ç `update.sh`.

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø–æ–º–æ—â—å—é Docker –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:

```bash
docker-compose up -d
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Å–¥–µ–ª–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000` —Å –ë–î, –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –ú—ã —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ–º —Å–µ—Ç—å, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –º–æ–≥–ª–∏ –æ–±—â–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π.

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Prisma Studio:

```bash
npx prisma studio
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `docker-compose ps` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker
- `docker-compose logs web` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–æ–≤ Next.js
- `docker-compose logs cron` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–æ–≤ cron
- `docker-compose down` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker
- `docker-compose up -d` - –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
- `sudo systemctl restart nginx` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
- `docker exec -it myapp-web-1 sh` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É Next.js
- `docker exec -it myapp-db-1 psql -U postgres -d mydb` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Postgres

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–ü—Ä–∏–º–µ—Ä Kubernetes](https://github.com/ezeparziale/nextjs-k8s)
- [–ê–¥–∞–ø—Ç–µ—Ä –∫—ç—à–∞ Redis –¥–ª—è Next.js](https://github.com/vercel/next.js/tree/canary/examples/cache-handler-redis)
- [ipx - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π](https://github.com/unjs/ipx)
- [OrbStack - –±—ã—Å—Ç—Ä—ã–π –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Docker](https://orbstack.dev/)
